<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
<style>
button.accordion {
    background-color: #eee;
    color: #444;
    cursor: pointer;
    padding: 18px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    transition: 0.4s;
}

button.accordion.active, button.accordion:hover {
    background-color: #ddd;
}

button.accordion:after {
    content: '\002B';
    color: #777;
    font-weight: bold;
    float: right;
    margin-left: 5px;
	margin-right: -130px;
}

button.accordion.active:after {
    content: "\2212";
}

div.panel {
    padding: 0 18px;
    background-color: white;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease-out;
}
</style>
<div class="container" style="padding-top: 103px; padding-bottom: 20px;">
  <div class="inner-container">
    <div class="mybreadcrumb"><a href="/">Home</a> > <a href="/vendors">Vendors Info</a> > <span>{{vendor.name}}</span></div>
  </div>
</div>
<div class="vendor_profile_info">
    <div class="vendor_profile">
        <img src="{{vendor.vendor_image}}"/>
        <div class="vendor_title vendor_info">{{vendor.name}}<div style="font-size:14px;">{{vendor.email}}</div></div>
    </div>
</div>
<div class="container" style="padding-top: 13px;">
    <div class="inner-container">
        <div class="gallery-section">
            <div id="tabs">
				<ul>
					<li><a href="#tabs-1">My Info</a></li>
					<li><a href="#tabs-2">Gallery</a></li>
					<li><a href="#tabs-3">Promotions</a></li>
				</ul>
				<div id="tabs-1">
					<form name="save-vendor-info" id="save-vendor-info" method="post">
					<div class="addCats-danger alert alert-danger" style="display:none;">Select atleast one category!</div>
					<div class="info1">
						<input type="text" name="vendor_desc" id="vendor_desc" placeholder="Your Description" value="{{vendorinfo.vendor_desc}}" required>
						<input type="text" name="phone_number" id="phone_number" placeholder="Phone Number" value="{{vendorinfo.phone_number}}" required>
					</div>
					<div class="info2">
						<select name="vendor_location" id="vendor_location" required>
							<option value="">Select Location</option>
							{{#each locations}}
								<option value="{{id}}" {{dropdownSelectedValue this.id this.selected}}>{{location}}</option>
							{{/each}}
						</select>
						<a href="javascript:void(0);" class="ven_cats">Add Category</a>
					</div>
					<input type="hidden" name="venCatCount" id="venCatCount" value="{{vendorCatsCount}}"/>
					<div class="v-categories">
						{{# if vendorCatsCount}}
						<input type="hidden" name="catIds" id="catIds" value="{{vCats}}">
						<ul>
							{{# vendorCats}}
							<li>
								<div class="cname"><input type="hidden" name="vendor_cat[]" id="vendor_cat[]" value="{{category_id}}">
									{{category_name}}<a href="javascript:void(0); class="del-vcat" data-catid="{{category_id}}"><img src="/images/cross_icon_white.png"></a>
								</div>
								<div class="price">
									<input type="text" name="min_price_{{category_id}}" id="min_price_{{category_id}}" value="{{min_price}}"><input type="text" name="max_price_{{category_id}}" id="max_price_{{category_id}}" value="{{max_price}}">
								</div>
							</li>
							{{/vendorCats}}
						<ul>
						{{/if}}
					</div>
					<input type="hidden" name="vendor_id" id="vendor_id" value="{{vendor.id}}"/>
					<input type="hidden" name="vendor_title" id="vendor_title" value="{{vendor.name}}"/>
					<input type="submit" name="submit_info" class="submit_info" value="Save"/>
					</form>
				</div>
				<div id="tabs-2">
					{{#albumCountLimit albumCount conf.album_count}}
						<div class="create-album"><a href="javascript:void(0);" data-toggle="modal" data-target="#createalbum">+ Create Album</a></div>
					{{/albumCountLimit}}
					<div class="album-list-view">
					{{#if albumCount}}
					<ul class="album_list">
						{{#each albums}}
						<li>
							{{#if images}}
								<div class="album" style="display:inline-block;" data-album-id="{{this.id}}"><img width="162" height="162" src="/{{getFirstImage this.images}}"><!--<span class="del-album" data-album-id="{{this.id}}">X</span>--></div>
							{{else}}
								<div class="album" style="display:inline-block;" data-album-id="{{this.id}}"><img width="162" height="162" src="/images/album_box.png"><!--<span class="del-album" data-album-id="{{this.id}}">X</span>--></div>
							{{/if}}
							<div class="album-title" data-album-id="{{this.id}}">{{this.album_name}}</div>
							<div class="image-count">{{count}} Photos</div>
						</li>
						{{/each}}
					</ul>
						{{#each albums}}
							<div class="album-view album-{{this.id}}" style="display:none;">
								<form name="upload-images" class="upload-images" id="upload-images-{{this.id}}" method="post" enctype="multipart/form-data" action="/vendors/uploadImages">
									<div class="choose-photo-text">Choose upto {{this.images_per_album}} photos that you'd like to add in album</div>
									{{#each this.img}}
										{{#blankImg this}}
											<label for="image_{{splitAlbum this}}_{{@index}}"><img width="162" height="162" src="/{{splitImage this}}"></label><input class="album_image" name="album_image" id="image_{{splitAlbum this}}_{{@index}}" type="file"/>
										{{else}}
											<label for="image_{{splitAlbum this}}_{{@index}}"><img width="162" height="162" src="/{{splitImage this}}"></label>
										{{/blankImg}}
									{{/each}}
									<input type="hidden" name="album_id" id="album_id" value="{{this.id}}"/>
									<input type="hidden" name="vendor_id" id="vendor_id" value="{{this.vendor_id}}"/>
									<div>
										<input type="submit" name="submit_info" class="upload_images" value="Save">
										<input type="button" name="cancel" class="cancel-images" data-album-id="{{this.id}}" value="Cancel">
									</div>
								</form>
							</div>
						{{/each}}
					{{else}}
					<div class="emptyView">
						<img src="/images/empty_album_icon.png">
						<div class="oops">Oops!</div>
						<div class="empty-event-msg">It looks like you have not added any albums.</div>
						<a href="javascript:void(0);" data-toggle="modal" class="noevent-btn" data-target="#createalbum"><img src="/images/add_album_bttn.png"/></a>
					</div>
					{{/if}}
					</div>
					<div id="wait" style="display:none;width:69px;height:89px;z-index:1;opacity:1;position:absolute;top:80%;left:45%;padding:2px;">
						<img src='/images/loader.png' width="64" height="64" />
					</div>
					<div class="album-view album-create-images" style="display:none;">
						<form name="upload-images" id="upload-images" method="post" enctype="multipart/form-data" action="/vendors/uploadImages">
							<div class="choose-photo-text">Choose upto {{conf.image_per_album}} photos that you'd like to add in album</div>
							<label for="image1"><img src="/images/album_box.png"></label><input class="album_image" name="album_image" id="image1" type="file"/>
							<label for="image2"><img src="/images/album_box.png"></label><input class="album_image" name="album_image" id="image2" type="file"/>
							<label for="image3"><img src="/images/album_box.png"></label><input class="album_image" name="album_image" id="image3" type="file"/>
							<label for="image4"><img src="/images/album_box.png"></label><input class="album_image" name="album_image" id="image4" type="file"/>
							<label for="image5"><img src="/images/album_box.png"></label><input class="album_image" name="album_image" id="image5" type="file"/>
							<input type="hidden" name="album_id" id="album_id"/>
							<input type="hidden" name="vendor_id" id="vendor_id" value="{{vendor.id}}"/>
							<div><input type="submit" name="submit_info" class="upload_images" value="Save"></div>
						</form>
					</div>
				</div>
				<div id="tabs-3">
					<div class="create-album"><a href="javascript:void(0);" data-toggle="modal" data-target="#addpromotion">+ Add Promotion</a></div>
					{{#if promotionCount}}
					{{#each promotions}}
					<button class="accordion">{{this.category_name}}<span style="float:right; margin-right: 30px;">DISCOUNT {{this.discount}}</span></button>
					<div class="panel">
					  <p>{{this.description}}</p>
					</div>
					{{/each}}
					{{else}}
					<div class="emptyView">
						<img src="/images/empty_album_icon.png">
						<div class="oops">Oops!</div>
						<div class="empty-event-msg">It looks like you have not added any promotions.</div>
						<a href="javascript:void(0);" data-toggle="modal" class="noevent-btn" data-target="#addpromotion"><img src="/images/add_album_bttn.png"/></a>
					</div>
					{{/if}}
				</div> 
            </div>
        </div>
        <div class="popular-section">
			<div class="main-title">Popular Vendors</div>
			{{#each popVen}}
				<div class="pop-vendor"><a href="/vendors/detail/{{this.vendor_slug}}"><img src="{{this.vendor_image}}"></a></div>
				<div class="title"><a href="/vendors/detail/{{this.vendor_slug}}">{{this.vendor_title}}</a></div>
				<div class="prop">{{this.location}}</div>
			{{/each}}
        </div>
    </div>
</div>

<!-- Select vendor category modal -->
<div class="modal fade" id="vendorCats">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- header -->
      <div class="modal-header">
        <div class="forgot-title">Select a Category</div>
        <button type="button" class="close" data-dismiss="modal"></button>
      </div>

      <!-- body -->
      <form name="select-vendor-cats" id="select-vendor-cats" method="post">
        <div class="modal-body">
          <div class="selectCats-danger alert alert-danger" style="display:none;">Select atleast one category!</div>
          <div class="form-group">
            {{onlyVenCats}}
            {{#each categories}}
              <label class="control control--checkbox {{this.vendor_category_id}}">{{this.category_name}}
                <input type="checkbox" {{checklistSelectedValue this.is_assigned}} name="vendor-selected-cats[]" data-cname="{{this.category_name}}" data-min-price="{{this.min_price}}" data-max-price="{{this.max_price}}" value="{{this.vendor_category_id}}" />
                <div class="control__indicator" style="left:0 !important;"></div>
              </label>
            {{/each}}
          </div>
        </div>

        <!-- button -->
        <div class="modal-footer myfooter">
          <input type="submit" class="btn btn-primary btn-block btn-login" value="Submit" />
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Select vendor category modal ends -->

<!-- Create Album modal -->
<div class="modal fade" id="createalbum">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- header -->
      <div class="modal-header">
        <div class="forgot-title">Create Album</div>
        <button type="button" class="close" data-dismiss="modal"></button>
      </div>

      <!-- body -->
      <form name="create-album" id="create-album" method="post">
        <div class="modal-body">
          <div class="form-group">
            <input type="text" class="form-control inputbox" name="album_name" id="album_name" placeholder="Album Name" required>
          </div>
          <div class="form-group">
            <select class="form-control selectbox" name="album_category" id="album_category" placeholder="Select Category" required>
            <option value="">Select Category</option>
            {{#each categories}}
              <option value="{{this.vendor_category_id}}">{{this.category_name}}</option>
            {{/each}}
            </select>
          </div>
          <input type="hidden" name="vendor_id" id="vendor_id" value="{{vendor.id}}"/>
        </div>

        <!-- button -->
        <div class="modal-footer myfooter">
          <input type="submit" class="btn btn-primary btn-block btn-login" value="Submit" />
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Create Album modal ends -->

<!-- Add Promotion modal -->
<div class="modal fade" id="addpromotion">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- header -->
      <div class="modal-header">
        <div class="forgot-title">Add Promotion</div>
        <button type="button" class="close" data-dismiss="modal"></button>
      </div>

      <!-- body -->
      <form name="save-promotions" id="save-promotions" method="post">
        <div class="modal-body">
          <div class="form-group">
            <select class="form-control selectbox" name="category_id" id="category_id" placeholder="Select Category" required>
            <option value="">Select Category</option>
            {{#each categories}}
              <option value="{{this.vendor_category_id}}">{{this.category_name}}</option>
            {{/each}}
            </select>
          </div>
          <div class="form-group">
            <input type="text" class="form-control inputbox" name="discount" id="discount" placeholder="Percentage" required>
          </div>
          <div class="form-group">
            <textarea class="form-control inputbox" name="description" id="description" placeholder="Discount Description" required style="height: 80px;"></textarea>
          </div>
          <input type="hidden" name="vendor_id" id="vendor_id" value="{{vendor.id}}"/>
        </div>

        <!-- button -->
        <div class="modal-footer myfooter">
          <input type="submit" class="btn btn-primary btn-block btn-login" name="submit_promotion" class="submit_promotion" value="Add Promotion"/>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Add Promotion modal ends -->

<!-- Info Save Success Modal -->
<div class="modal fade" id="infosave_success_modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- header -->
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"></button>
      </div>

      <!-- body -->
      <div class="modal-body">
        <img src="/images/message.png"/>
      </div>

      <!-- button -->
      <div class="modal-footer myfooter">
        <p class="great">Great!</p>
        <p class="great_msg">Info Saved!</p>
      </div>
    </div>
  </div>
</div>
<!-- Info Save Success Modal Ends -->
<script>
$( function() {
    $( "#tabs" ).tabs();
} );

var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
  acc[i].onclick = function() {
    this.classList.toggle("active");
    var panel = this.nextElementSibling;
    if (panel.style.maxHeight){
  	  panel.style.maxHeight = null;
    } else {
  	  panel.style.maxHeight = panel.scrollHeight + 'px';
    } 
  }
}

jQuery('.ven_cats').on('click', function(){
  jQuery('#vendorCats').modal('show');
});

jQuery('#select-vendor-cats').submit(function(e) {
  e.preventDefault();
  var checkboxes = $('#select-vendor-cats input:checked');
  jQuery('#venCatCount').val(checkboxes.length);

  var catIds = '';
  checkboxes.each(function() {
    catIds += jQuery(this).val()+',';
  });
  catIds = catIds.substring(0,(catIds.length-1));
  if(catIds == ''){
    $('.selectCats-danger').css('display', 'block');
    $('.selectCats-danger').focus();
  }else{
    var catData = '<input type="hidden" name="catIds" id="catIds" value="'+catIds+'">';
    catData += '<ul>';
    checkboxes.each(function() {
      catData += '<li>';
      catData += '<div class="cname"><input type="hidden" name="vendor_cat[]" id="vendor_cat[]" value="'+jQuery(this).val()+'">'+jQuery(this).data('cname')+'<a href="javascript:void(0); class="del-vcat" data-catid="'+jQuery(this).val()+'"><img src="/images/cross_icon_white.png"></a></div>';
      catData += '<div class="price"><input type="text" name="min_price_'+jQuery(this).val()+'" id="min_price_'+jQuery(this).val()+'" value="'+jQuery(this).data("min-price")+'"><input type="text" name="max_price_'+jQuery(this).val()+'" id="max_price_'+jQuery(this).val()+'" value="'+jQuery(this).data("max-price")+'"></div>';
      catData += '</li>';
    });
    catData += '</ul>';
    jQuery('.v-categories').html(catData);
    jQuery('#vendorCats').modal('hide');
  }
});

jQuery('#save-vendor-info').on('submit', function(e) {
  e.preventDefault();
  jQuery('.addCats-danger').css('display', 'none');
  var formData = jQuery('#save-vendor-info').serializeArray();
  var catCount = jQuery('#venCatCount').val();
  if(catCount == 0){
    jQuery('.addCats-danger').css('display', 'block');
    jQuery('.addCats-danger').focus();
  }else{
    jQuery.ajax({
      type: 'POST',
      data: formData,
      url: '/vendors/addVendor',
      success: function(data){
        if(data.status == true){
          jQuery('#infosave_success_modal').modal('show');
          setTimeout(function(){
            jQuery('#infosave_success_modal').modal('hide');
            //location.reload();
          }, 2000);
        }else{
        }
      }
    });
  }
});

jQuery('#save-promotions').on('submit', function(e) {
  e.preventDefault();
  var formData = jQuery('#save-promotions').serializeArray();
  jQuery.ajax({
    type: 'POST',
    data: formData,
    url: '/vendors/add-promotion',
    success: function(data){
      if(data.status == true){
		jQuery('#addpromotion').modal('hide');
        jQuery('#infosave_success_modal').modal('show');
        setTimeout(function(){
          jQuery('#infosave_success_modal').modal('hide');
          location.reload();
        }, 2000);
      }else{
      }
    }
  });
});

jQuery('#create-album').on('submit', function(e) {
  e.preventDefault();
  var albumName = jQuery('#album_name').val();
  var albumCategory = jQuery('#album_category').val();
  var vendorId = jQuery('#vendor_id').val();
  var myData = {
    'album_name': albumName,
    'category_id': albumCategory,
    'vendor_id': vendorId
  };
  jQuery.ajax({
    type: 'POST',
    data: myData,
    url: '/vendors/create-album',
    success: function(data){
      if(data.status == true){
        jQuery('#createalbum').modal('hide');
		jQuery('.album-list-view .album-view').css('display', 'none');
		jQuery('.album-list-view .album_list').css('display', 'none');
        jQuery('.album-create-images #album_id').val(data.album_id);
        jQuery('.album-create-images').css('display', 'block');
      }else{
      }
    }
  });
});

jQuery('#upload-images, .upload-images').on('submit', function(e){
	e.preventDefault();
	var albumId = jQuery('#album_id').val();
	var vendorId = jQuery('#vendor_id').val();
	jQuery(this).ajaxSubmit({
		data: {albumId: albumId},
		contentType: 'application/json',
		beforeSend: function(){
			jQuery('#wait').css('display','block');
		},
		success: function(data){
			if(data.status == true){
				jQuery('.album-view').css('display', 'none');
				//jQuery('.album-list-view .album-view').css('display', 'none');
				//jQuery('.album-view #album_id').val(data.album_id);
				jQuery.ajax({
					type: 'GET',
					url: '/vendors/getAlbum/'+vendorId,
					success: function(data){
						if(data.albums){
							var venAlb = '';
							jQuery.each(data.albums, function(key, value){
								venAlb += '<li><div class="album" style="display:inline-block;" data-album-id="'+value.id+'"><img width="162" height="162" src="/'+value.images.split(',')[0]+'"></div>';
								venAlb +='<div class="album-title" data-album-id="'+value.id+'">'+value.album_name+'</div>';
								venAlb +='<div class="image-count">'+value.count+' Photos</div></li>';
							});
							jQuery('.album-list-view .album_list').html(venAlb);
						}
						jQuery('.album-list-view .album_list').css('display', 'block');
						jQuery('#wait').css('display','none');
					}
				});
			}
		}
	});
    return false;
});

jQuery(".album_image").change(function() {
	var prev = jQuery(this).prev()[0];
	if (this.files && this.files[0]) {
		var reader = new FileReader();
		reader.onload = function(e) {
			jQuery(prev).html('<img src="'+e.target.result+'" width="162" height="162">');
			//jQuery(this).prev()[0].html('gggg');
		}
		reader.readAsDataURL(this.files[0]);
	}
});

jQuery(document).delegate('.album-list-view ul li .album, .album-list-view ul li .album-title', 'click', function(){
	var albumId = jQuery(this).data('album-id');
	var identifier = '.album-'+albumId;
	jQuery('.album-list-view ul').css('display', 'none');
	jQuery(identifier).css('display', 'block');
});
jQuery('.cancel-images').on('click', function(){
	var albumId = jQuery(this).data('album-id');
	var identifier = '.album-'+albumId;
	jQuery(identifier).css('display', 'none');
	jQuery('.album-list-view ul').css('display', 'block');
});
/*jQuery('.del-album').on('click', function(e){
	e.preventDefault();
	var albumId = jQuery(this).data('album-id');
	confirm("Are you sure you want to delete this ");
});*/
</script>